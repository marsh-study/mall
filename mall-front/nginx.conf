server {
    listen 80; 
    server_name _;

    # 启用真实IP模块配置
    set_real_ip_from 172.16.0.0/12;  # Docker默认网段
    set_real_ip_from 192.168.0.0/16; # 局域网网段
    set_real_ip_from 10.0.0.0/8;     # 私有网络网段
    real_ip_header X-Forwarded-For;
    real_ip_recursive on;

    # 1. 前端静态文件（指向你的前端目录，不变）
    location / {
        root /usr/share/nginx/html;
        index index.html index.htm;
        try_files $uri $uri/ /index.html;
    }

    # 2. API代理：dev-api
    location /dev-api/ {
        # 传递客户端原始IP
        proxy_set_header X-Real-IP $remote_addr;
        # 传递完整的IP链路
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        # 传递原始请求的Host
        proxy_set_header Host $host;
        # 传递原始请求的协议
        proxy_set_header X-Forwarded-Proto $scheme;
        # 后端服务地址
        proxy_pass http://host.docker.internal:9999/;
        # 确保代理连接正常
        proxy_connect_timeout 60s;
        proxy_read_timeout 60s;
    }

    # 3. API代理：prod-api
    location /prod-api/ {
        # 传递客户端原始IP
        proxy_set_header X-Real-IP $remote_addr;
        # 传递完整的IP链路
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        # 传递原始请求的Host
        proxy_set_header Host $host;
        # 传递原始请求的协议
        proxy_set_header X-Forwarded-Proto $scheme;
        # 后端服务地址
        proxy_pass http://host.docker.internal:9999/;
        # 确保代理连接正常
        proxy_connect_timeout 60s;
        proxy_read_timeout 60s;
    }
}